@using Microsoft.AspNet.Identity

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - LooP</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    <link href="~/Content/css/IndexStyle.css" rel="stylesheet" />
    <link href="~/Content/css/main.min.css" rel="stylesheet" />
    <link href="~/Content/css/style.css" rel="stylesheet" />
    <link href="~/Content/css/color.css" rel="stylesheet" />
    <link href="~/Content/css/responsive.css" rel="stylesheet" />
    <link href="~/Content/css/Chat.css" rel="stylesheet" />

</head>
<body>
    <div class="container-fluid">
        @Html.Partial("_NavigationBar")
        @RenderBody()
        <hr />

        <div>
            @Html.Partial("_Footer")
            @Html.Partial("_Chat")
        </div>
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    @Scripts.Render("~/bundles/signalr")
    @Scripts.Render("/signalr/hubs")

    <script>
        $(function () {
            $("#addClass").on('click', function (event) {
                event.preventDefault();
                $('#sidebar_secondary').addClass('popup-box-on');
            });

            $("#removeClass").on('click', function (event) {
                event.preventDefault();
                $('#sidebar_secondary').removeClass('popup-box-on');
            });
        });
    //TODO: change 60ln and 73 na sugrinw Roles

$(function () {
    // Reference the auto-generated proxy for the hub.
    var chat = $.connection.chatHub;
    // Create a function that the hub can call back to display messages.
    chat.client.addNewMessageToPage = function (name, message) {
        let time = new Date();

        if (name == "kokarolos@gmail.com") {
        // Add the message to the page.
        $('#chat').append('<div class="chat_message_wrapper">' +
            '<div class="chat_user_avatar">' +
            '<a href="https://web.facebook.com/iamgurdeeposahan" target="_blank">' +
            '<img alt="Gurdeep Osahan (Web Designer)" title="Gurdeep Osahan (Web Designer)"' +
            'src="http://webncc.in/img/user/gurdeep-singh-osahan.jpg" class="md-user-image"</a></div>' +
            '<ul class="chat_message">' +
            '<li><p>' + name + " : " + htmlEncode(message) +
            '<span class="chat_message_time">' + time.getHours() + ':' + time.getMinutes() + '</span>' +
            '</p ></li ></ul ></div > ');

        }
        else if (name != "kokarolos@gmail.com") {
        // Add the message to the page.
        $('#chat').append('<div class="chat_message_wrapper chat_message_right">' +
            '<div class="chat_user_avatar">' +
            '<a href="https://web.facebook.com/iamgurdeeposahan" target="_blank">' +
            '<img alt="Gurdeep Osahan (Web Designer)" title="Gurdeep Osahan (Web Designer)"' +
            'src="http://webncc.in/img/user/gurdeep-singh-osahan.jpg" class="md-user-image"</a></div>' +
            '<ul class="chat_message">' +
            '<li><p>' + name + " : " + htmlEncode(message) +
            '<span class="chat_message_time">' + time.getHours() + ':' + time.getMinutes() + '</span>' +
            '</p ></li ></ul ></div > ');
                //'<span><i class="ti-check"></i><i class="ti-check">' + time.getHours() + ':' + time.getMinutes() + '</i></span></div></li > ');
        }

    };

    // Get the user name and store it to prepend to messages.
    //$('#displayname').val(prompt('Enter your name:', ''));
    $("#form").on("submit", function (event) {
        event.preventDefault();
    });
    
    var name = "@User.Identity.GetUserName()";
    $('#displayname').val(name);
    // Set initial focus to message input box.
    $('#message').focus();
    // Start the connection.
    $.connection.hub.start().done(function () {
        $('#sendmessage').click(function () {
            // Call the Send method on the hub.
            chat.server.send($('#displayname').val(), $('#message').val());
            // Clear text box and reset focus for next comment.
            $('#message').val('').focus();
        });
    });
    });
    // This optional function html-encodes messages for display in the page.
    function htmlEncode(value) {
        var encodedValue = $('<div />').text(value).html();
        return encodedValue;
    }

    </script>

    @RenderSection("scripts", required: false)

</body>
</html>


